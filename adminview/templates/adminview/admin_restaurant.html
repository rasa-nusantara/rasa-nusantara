{% extends 'base.html' %}
{% load static %}
{% block meta %}
<title>Admin View - Rasa Nusantara</title>
{% endblock meta %}
{% block content %}
{% include 'navbar.html' %}

<div class="min-h-screen flex flex-col bg-[#453229] w-full pt-20 pb-8">
    <section class="mb-12">
        <div class="flex items-center justify-between px-6 mb-6">
            <h1 class="text-2xl text-white">Restaurant Management</h1>
            <a href="{% url 'adminview:add_restaurant' %}" class="bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600 transition duration-300">Add New Restaurant</a>
        </div>

        <div class="flex flex-row items-center justify-center mb-6">      
            <!-- Form Dropdown Kategori dan Sorting -->
            <form method="GET" class="flex items-center space-x-4">
              <!-- Dropdown untuk memilih kategori -->
              <select name="category" onchange="this.form.submit()" class="border p-2 rounded bg-white text-gray-800">
                <option value="">Pilih Kategori</option>
                {% for category in categories %}
                    <option value="{{ category.id }}" {% if category.id == selected_category %}selected{% endif %}>
                        {{ category.name }}
                    </option>
                {% endfor %}
              </select>
              <select name="sorting" onchange="this.form.submit()" class="border p-2 rounded bg-white text-gray-800">
                <option value="">Urutkan Berdasarkan Harga</option>
                <option value="low_to_high" {% if selected_sort == 'low_to_high' %}selected{% endif %}>Harga Terendah</option>
                <option value="high_to_low" {% if selected_sort == 'high_to_low' %}selected{% endif %}>Harga Tertinggi</option>
              </select>
            </form>
            </form>
        </div>

            <!-- Dropdown untuk sorting harga -->

        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 px-6">
            {% for restaurant in restaurants %}
                <div class="bg-white shadow-lg rounded-2xl overflow-hidden flex flex-col transition duration-300 hover:scale-105 hover:shadow-2xl">
                    {% if restaurant.image %}
                        <img src="{{ restaurant.image }}" alt="{{ restaurant.name }}" class="rounded-t-2xl h-[180px] object-cover">
                    {% else %}
                        <img src="https://www.creativefabrica.com/wp-content/uploads/2020/03/09/Simple-Fork-Plate-Icon-Restaurant-Logo-Graphics-3446203-1-1-580x348.jpg" alt="{{ restaurant.name }}" class="rounded-t-2xl bg-slate-200 h-[180px] object-cover">
                    {% endif %}
                    
                    <div class="flex flex-col p-4">
                        <h3 class="text-lg font-bold text-gray-800">{{ restaurant.name|truncatechars:28 }}</h3>
                        <p class="text-sm text-gray-600 mb-1 truncate">{{ restaurant.location }}</p>
                        <div class="flex items-center mb-4">
                            <img src="{% static 'image/star.png' %}" alt="Rating" class="mr-1 w-[17px] h-[17px] rounded-lg">
                            <p class="text-sm text-gray-600">{{ restaurant.rating }}/5</p>
                        </div>

                        <div class="flex gap-2">
                            <a href="{% url 'adminview:edit_restaurant' uuid=restaurant.id|stringformat:'s' %}" class="bg-blue-500 text-white px-3 py-1 rounded hover:bg-blue-600">Edit</a>
                           
                            <form method="POST" 
                            action="{% url 'adminview:delete_restaurant' uuid=restaurant.id|stringformat:'s' %}"
                            class="inline"
                            onsubmit="return confirm('Are you sure you want to delete this restaurant?');">
                          {% csrf_token %}
                            <button type="submit"
                                  class="bg-red-500 text-white px-3 py-1 rounded hover:bg-red-600">
                              Delete
                             </button>
                            </form>

                            <a href="{% url 'menu_management:admin_menu' restaurant.id %}" class="bg-yellow-500 text-white px-3 py-1 rounded hover:bg-yellow-600 transition duration-200">View Menu</a>
                        </div>
                    </div>
                </div>

            {% endfor %}
        </div>
    </section>
</div>

<script>
function confirmDelete(id) {
    if (confirm('Are you sure you want to delete this restaurant?')) {
        window.location.href = `/adminview/delete/${id}/`;
    }
}
</script>
{% endblock content %}
